---
title: "Kubecostã§AKSä¸Šã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®ã‚³ã‚¹ãƒˆç®¡ç†"
emoji: "ğŸ–"
type: "tech"
topics: ["Azure","AKS","FinOps","Cost Management","Kubecost","Opencost"]
published: true
---

ã“ã®è¨˜äº‹ã§ã¯ã€AKSï¼ˆAzure Kubernetes Serviceï¼‰ä¸Šã§å‹•ããƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®ã‚³ã‚¹ãƒˆã‚’è¦‹ãˆã‚‹åŒ–ãƒ»é…è³¦ã™ã‚‹æ–¹æ³•ã‚’ã–ã£ãã‚Šç´¹ä»‹ã—ã¾ã™ã€‚  

ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’é‹ç”¨ã™ã‚‹ã¨ãã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ä¸¦ã‚“ã§ã€Œã‚³ã‚¹ãƒˆç®¡ç†ã€ã‚‚ã¨ã¦ã‚‚å¤§äº‹ã§ã™ã€‚
è¦æ¨¡ãŒå¤§ãããªã‚‹ã¨å…±é€šåŸºç›¤ã¨å„æ¥­å‹™ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«åˆ†ã‘ã¦ç®¡ç†ã™ã‚‹ã“ã¨ãŒå¤šãã€
ã“ã‚Œã‚’ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å˜ä½ã§åˆ†ã‘ã‚‹ã“ã¨ã§ã‚³ã‚¹ãƒˆã®é›†è¨ˆã‚‚å®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

ãŸã ã—ã€Kubernetes ã®å ´åˆã¯æ§˜ç›¸ãŒç•°ãªã‚Šã¾ã™ã€‚
AKS ãªã©ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸Šã§ã¯åå‰ç©ºé–“ã‚„ãƒ©ãƒ™ãƒ«ã€ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã®åˆ†é›¢ã«ã‚ˆã‚Šè¤‡æ•°ã®æ¥­å‹™ãŒå…±å­˜ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚„ãƒãƒ¼ãƒ‰ãŒç•°ãªã‚‹ã‚±ãƒ¼ã‚¹ã§ã¯ã€Azure Cost Management ã§é›†è¨ˆãŒå¯èƒ½ã§ã™ãŒã€
åå‰ç©ºé–“ã‚„ Pod ãƒ©ãƒ™ãƒ«ã«ãªã‚‹ã¨ãã‚ŒãŒè¡Œãˆã¾ã›ã‚“ã€‚

![alt text](/images/c06c11db912cc8/kubecost1.png)

# ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

Azure ã§ã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚³ã‚¹ãƒˆç®¡ç†æ©Ÿèƒ½ã¨ã—ã¦ [Azure Cost Management](https://learn.microsoft.com/ja-jp/azure/cost-management-billing/costs/overview-cost-management) ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã§ã€Azure Kubernetes Service (AKS) ã®ã‚³ã‚¹ãƒˆã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![alt text](/images/c06c11db912cc8/kubecost2.png)

è¦‹ã‚‹ã¨ã€AKS (ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å akslab1) ã¨ãã‚Œã«ç´ã¥ããƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ« (ä»®æƒ³ãƒã‚·ãƒ³ ã‚¹ã‚±ãƒ¼ãƒ«ã‚»ãƒƒãƒˆ) ã®ã‚³ã‚¹ãƒˆã¯åˆ†ã‹ã‚Šã¾ã™ãŒã€
ã‚„ã¯ã‚Šãã‚Œä»¥ä¸Šã®åˆ†è§£èƒ½ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€ã“ã®è¨˜äº‹ã§ã¯ Kubernetes ã«ãŠã„ã¦ç¨¼åƒã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®ã‚³ã‚¹ãƒˆã‚’ã©ã®ã‚ˆã†ã«ã¯ã˜ãå‡ºã™ã‹ã¨ã„ã†ç‚¹ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

# OpenCost / Kubecost

ã“ã®ãƒˆãƒ”ãƒƒã‚¯ã§ã‚ˆãå‡ºã¦ãã‚‹åå‰ã¯ OpenCost ã¨ Kubecost ã§ã™ã€‚
OpenCost ã¯ CNCF ç®¡ç†ã® ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã€Kubecost ã¯ OpenCost ã‚’ãƒ™ãƒ¼ã‚¹ã«ä¼æ¥­å‘ã‘æ©Ÿèƒ½ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆã‚„äºˆæ¸¬ã€ç•°å¸¸æ¤œå‡ºãªã©ï¼‰ã‚’è¶³ã—ãŸã‚‚ã®ã€ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

[Kubecostã¨OpenCostã®æ¯”è¼ƒ](https://www.apptio.com/topics/kubernetes/cost-optimization/kubecost-vs-opencost/test)

Azure å´ã«ã‚‚ OpenCost ãƒ™ãƒ¼ã‚¹ã®[ã‚³ã‚¹ãƒˆåˆ†æã‚¢ãƒ‰ã‚ªãƒ³](https://learn.microsoft.com/ja-jp/azure/aks/cost-analysis)ãŒã‚ã‚Šã¾ã™ãŒã€
å¥‘ç´„ç¨®åˆ¥ã§ä½¿ãˆãªã„å ´åˆãŒã‚ã‚‹ãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯ Helm ã§ Kubecost ã‚’å…¥ã‚Œã¦è©¦ã—ã¦ã¿ã¾ã™ã€‚

> "Kubernetes ã®ã‚³ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹" ã‚ˆã‚ŠæŠœç²‹
> Kubernetes ã®ã‚³ã‚¹ãƒˆ ãƒ“ãƒ¥ãƒ¼ã¯ã€æ¬¡ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å¥‘ç´„ã®ç¨®é¡ã§ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚  
> - Enterprise Agreement  
> - Microsoft é¡§å®¢å¥‘ç´„  

# Kubecost ã®å°å…¥

ã¾ãšã¯ã€Azure ã« AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ã‚‡ã†ã€‚
æ—¢ã« AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å±•é–‹æ¸ˆã¿ã®æ–¹ã‚‚ã„ã‚‹ã‹ã¨æ€ã†ã®ã§ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã¯æŠ˜ã‚ŠãŸãŸã‚“ã§ãŠãã¾ã™ã€‚

::::details ç’°å¢ƒæ§‹ç¯‰æ‰‹é †
:::message

ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ

```bash
$ az group create --name rg-akslab --location japaneast
```

AKS ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆä¾‹ï¼‰

```bash
$ az aks create -g rg-akslab -n akslab1 --node-count 3 --ssh-key-value ~/.ssh/id_rsa.pub --attach-acr acrforakslab --node-vm-size Standard_D4ds_v4
```

ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹

```bash
$ sudo az aks install-cli
$ az aks get-credentials --resource-group rg-akslab --name akslab1 --overwrite-existing
$ kubectl create namespace app
$ kubectl apply -f https://raw.githubusercontent.com/Azure-Samples/aks-store-demo/refs/heads/main/aks-store-quickstart.yaml -n app
```

å‹•ä½œç¢ºèªï¼ˆPod ã® STATUS ãŒ Running ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰

```bash
$ kubectl get pods -n app
```

ã‚µãƒ¼ãƒ“ã‚¹ã®å…¬é–‹ IP ã‚’å–å¾—ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

```bash
$ kubectl get service store-front -n app -o jsonpath='{.status.loadBalancer.ingress[0].ip}'
```

:::
::::

ãã‚Œã§ã¯ã€Kubecost ã‚’ AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
Helm ãƒãƒ£ãƒ¼ãƒˆã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã®ã§ã€[[Helm ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«]](https://helm.sh/docs/intro/install/)ãŒã¾ã ã§ã—ãŸã‚‰ã€
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚

Helm ãƒãƒ£ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ Kubecost ã‚’å…¥ã‚Œã¾ã™ã€‚Helm ãŒç„¡ã‘ã‚Œã°å…ˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```bash
$ helm install kubecost cost-analyzer --repo https://kubecost.github.io/cost-analyzer/ --namespace kubecost --create-namespace
```

Pod ãŒ Ready ã«ãªã£ãŸã‚‰ UI ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§è¦‹ã‚‹ãŸã‚ã« portâ€‘forward ã—ã¾ã™ï¼ˆä¾‹: http://localhost:9090ï¼‰ã€‚

```bash
$ kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 9090
```

Pod ãŒ "Ready" ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
Kubecost ã¯ Prometheus ã‹ã‚‰ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚’å¾—ã¦ã‚³ã‚¹ãƒˆåˆ†å‰²ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã§ Prometheus ã¨ Grafana ãŒå±•é–‹ã•ã‚Œã¾ã™ãŒã€
[æ—¢å­˜ã® Prometheus ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½](https://www.ibm.com/docs/en/kubecost/self-hosted/2.x?topic=configuration-prometheus-guide)ã§ã™ã€‚

```bash
$ kubectl get pods -n kubecost
NAME                                          READY   STATUS    RESTARTS   AGE
kubecost-cost-analyzer-5d679c857b-xjhg6       4/4     Running   0          2d4h
kubecost-forecasting-8cd68f7c5-6pm68          1/1     Running   0          2d4h
kubecost-grafana-5688b4fdb5-fbwft             2/2     Running   0          2d4h
kubecost-prometheus-server-6565bdcff4-xn57l   1/1     Running   0          2d4h
```

ãã‚Œã§ã¯ Kubecost ã® Web ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
[å…¬é–‹ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½](https://learn.microsoft.com/en-us/community/content/how-to-utilize-kubecost-for-cost-management-of-aks) ã§ã™ãŒã€ã“ã“ã§ã¯ ```kubectl port-foward``` ã«ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã® Web ãƒ–ãƒ©ã‚¦ã‚¶ã§ ```http://localhost:9090``` ã‚’é–‹ãã¾ã™ã€‚

```bash
$ kubectl port-forward --namespace kubecost deployment/kubecost-cost-analyzer 9090
```

![alt text](/images/c06c11db912cc8/kubecost3.png)

ã‚³ã‚¹ãƒˆå‰²ã‚Šå½“ã¦ã®ç”»é¢ã¯ã“ã¡ã‚‰ã€‚
æ—¢å®šã§ã¯åå‰ç©ºé–“ (Namespace) æ¯ã«åˆ†é¡ã•ã‚Œã¦ã„ã¾ã™ã€‚

![alt text](kubecost4.png)

ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã®æ¡ä»¶ã‚’ä¾‹ãˆã°ãƒ©ãƒ™ãƒ«æ¯ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

![alt text](/images/c06c11db912cc8/kubecost5.png)

ã‚¢ã‚»ãƒƒãƒˆ (Assets) ã§ã¯ Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹æˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (ä»®æƒ³ãƒã‚·ãƒ³ã‚¹ã‚±ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã€ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãªã©) æ¯ã®ã‚³ã‚¹ãƒˆã®å†…è¨³ãŒç¢ºèªã§ãã¾ã™ã€‚

![alt text](/images/c06c11db912cc8/kubecost6.png)

ä¾¡æ ¼ã¯ã©ã†ã‚„ã£ã¦å–å¾—ã—ã¦ã„ã‚‹ã®ã‹ã¨ã„ã†ã¨ã€Azure ã®[å°å£²ã‚Šä¾¡æ ¼ API](https://learn.microsoft.com/ja-jp/rest/api/cost-management/retail-prices/azure-retail-prices) ã‹ã‚‰å–å¾—ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```bash
$ kubectl logs kubecost-cost-analyzer-5d679c857b-n5xcz -n kubecost -f
...
27japaneast%27+and+armSkuName+eq+%27standard_d4ds_v4%27"
2025-08-22T08:43:20.269192099Z INF starting download retail price payload from "https://prices.azure.com/api/retail/prices?$skip=0&currencyCode='USD'&$filter=armRegionName+eq+%27japaneast%27+and+armSkuName+eq+%27standard_d4ds_v4%27"
```

ã•ã‚‰ã«ã€ç¯€ç´„ (Savings) ã®ã‚¿ãƒ–ã§ã¯ã€å„ç¯€ç´„è¦³ç‚¹ã«ãŠã„ã¦æœˆé¡è¾ºã‚Šã®ç¯€ç´„äºˆæƒ³é¡ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚
ä»Šã®ã¨ã“ã‚ã€AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç¯€ç´„ã®æ¨å¥¨ã«å¾“ã„ã€
ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã‚µã‚¤ã‚¸ãƒ³ã‚°ã‚„ã€åå‰ç©ºé–“ã®ã‚¿ãƒ¼ãƒ³ãƒ€ã‚¦ãƒ³ã®è‡ªå‹•åŒ–ãŒ Actions ã‹ã‚‰è¨­å®šå¯èƒ½ã§ã™ã€‚

![alt text](/images/c06c11db912cc8/kubecost7.png)

ãã®ä»–ã€äºˆç®—ç®¡ç†ã‚„ç•°å¸¸æ¤œå‡ºãªã©ã®æ©Ÿèƒ½ã‚‚ã‚ã‚Šã¾ã™ã®ã§ã€
èˆˆå‘³ã‚ã‚Œã°ã€[KubeCost ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.ibm.com/docs/en/kubecost/self-hosted/2.x?topic=navigating-kubecost-ui) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

# Azure ä¸Šã®ã‚³ã‚¹ãƒˆã¨ã®çµ±åˆ

æœ€å¾Œã«ã€Azure ä¸Šã®ã‚³ã‚¹ãƒˆã¨ KubeCost ã®ã‚³ã‚¹ãƒˆã‚’çµ±åˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
å…ˆã»ã©ã®ã‚ˆã†ã« Azure ãƒªã‚½ãƒ¼ã‚¹ã®ä¾¡æ ¼ã¯å°å£²ä¾¡æ ¼ API ã§å–å¾—ã•ã‚Œã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ Enterprise Agreement å¥‘ç´„ãªã©ãŠå®¢æ§˜ã«ãŠã„ã¦å‰²å¼•ä¾¡æ ¼ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ãã®å†…å®¹ã‚’åæ˜ ã•ã›ãªã‘ã‚Œã°ã€Kubecost ã®å†…å®¹ãŒäºˆæƒ³ã‚ˆã‚Šã‚‚é«˜ãå‡ºã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ãŒã‚ã‚Šå¾—ã¾ã™ã®ã§ã€
ãã‚Œã‚’åæ˜ ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æ–¹æ³•ã¨ã—ã¦ã¯ã€1ã¤ã‚ã‚Šã¾ã™ã€‚
å¾“é‡èª²é‡‘ãƒ—ãƒ©ãƒ³ã§ã¯æ¤œè¨¼ã«ã¯è‡³ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€å‰è€…ã®çµ±åˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ–¹ã§ã¯ã€
AKS ä»¥å¤–ã®ã‚³ã‚¹ãƒˆã‚‚å–ã‚Šè¾¼ã‚ Kubecost ã§ã‚³ã‚¹ãƒˆã®é…è³¦ãŒå¯èƒ½ãªãŸã‚ã€ãŠè–¦ã‚ã§ã™ã€‚

1. Cost Management ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ (Blob) ã¨çµ±åˆ
2. Azure Billing Rate Card API ã‚’åˆ©ç”¨

# ã¾ã¨ã‚

Kubecost ã‚’ä½¿ã†ã“ã¨ã§ã€AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸Šã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®ã‚³ã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ãŸã€‚
ã”å¥‘ç´„å½¢æ…‹ã«ä¾ã‚Šã¾ã™ãŒã€Azure Const Management ã§é›†ç´„ã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã€AKS ã®ã‚³ã‚¹ãƒˆåˆ†æã‚¢ãƒ‰ã‚ªãƒ³ãŒãŠè–¦ã‚ã§ã™ã€‚

[Kubernetes ã®ã‚³ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹](https://learn.microsoft.com/ja-jp/azure/cost-management-billing/costs/view-kubernetes-costs)

## å‚è€ƒ

* [Allocating Azure ML Costs with Kubecost](https://techcommunity.microsoft.com/blog/appsonazureblog/allocating-azure-ml-costs-with-kubecost/4414623)














