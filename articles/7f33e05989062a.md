---
title: "å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã®æ§‹ç¯‰"
emoji: "ğŸ“¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Azure","Windows","Hyer-V"]
published: true
---

å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã‚’æ‰‹æ—©ãç”¨æ„ã—ãŸã„å ´é¢ãŒã‚ã£ãŸã®ã§ã€ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

### å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã¨ã¯

å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã¨ã¯ã€ä»®æƒ³ãƒã‚·ãƒ³ã®ä¸­ã§ä»®æƒ³ãƒã‚·ãƒ³ã‚’å‹•ä½œã•ã›ã‚‹ãŸã‚ã€ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸä»®æƒ³ãƒã‚·ãƒ³ã‚’æŒ‡ã—ã¾ã™ã€‚[^1]

ãªãŠã€å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã«ã¤ã„ã¦ã¯ã€ãƒ†ã‚¹ãƒˆã‚„è©•ä¾¡ç›®çš„ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚[^2]

### æ–¹æ³•1 az vm repair create ã‚³ãƒãƒ³ãƒ‰

æ‰‹è»½ã«ä½œã‚‹æ–¹æ³•ã¨ã—ã¦ã¯ã€ä»®æƒ³ãƒã‚·ãƒ³ã®å¾©æ—§ã‚’ç›®çš„ã¨ã—ãŸ Azure CLI ã®ã‚³ãƒãƒ³ãƒ‰ az vm repair[^3] ã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ä»®æƒ³ãƒã‚·ãƒ³ãŒä½•ã‚‰ã‹ã®è¦å› ã§èµ·å‹•ã—ãªããªã£ãŸã‚·ãƒŠãƒªã‚ªã«ãŠã„ã¦ã€å¾©æ—§ç”¨ã®ä»®æƒ³ãƒã‚·ãƒ³ã«å¯¾è±¡ä»®æƒ³ãƒã‚·ãƒ³ã® OS ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ã‚¢ã‚¿ãƒƒãƒã—å¾©æ—§ä½œæ¥­ã‚’è¡Œã† (ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¾©æ—§) ã‚’ç°¡ç´ åŒ–ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

æ—¢ã« Azure CLI ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã—ãŸã‚‰ã€
ä»¥ä¸‹ã«ã¦ã€€```vm-repair``` æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```bash
$ az extension add -n vm-repair
```

ãã‚Œã§ã¯ã€ãƒ†ã‚¹ãƒˆç”¨ã®ä»®æƒ³ãƒã‚·ãƒ³ä½œã£ã¦ã¿ã¾ã™ã€‚

```bash
$ az group create -n labnestedvm -l japaneast
$ az vm create -g labnestedvm --name nestedvm --image Win2022Datacenter --admin-username azureuser --public-ip-address ""
```

:::message alert
"vm-repair" ãŒ "1.0.0b1" ã®å ´åˆã€Hyper-V ãŒæœ‰åŠ¹åŒ–ã•ã‚Œãªã„å•é¡ŒãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚[^4]

ã‚‚ã—ã“ã¡ã‚‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã—ãŸã‚‰ã€ä¸Šè¨˜ issue ã«ã‚ã‚‹ "Backup existing script" ãŠã‚ˆã³ "Revert back" ã®æ‰‹é †ã«ã¦å›é¿å¯èƒ½ã§ã™ã€‚

vm-repair ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªæ–¹æ³•

```bash
$ az version
{
  "azure-cli": "2.56.0",
  "azure-cli-core": "2.56.0",
  "azure-cli-telemetry": "1.1.0",
  "extensions": {
    "ai-examples": "0.2.5",
    "ml": "2.22.0",
    "ssh": "2.0.2",
    "vm-repair": "1.0.0b1"
  }
}
```

:::

ãã®å¾Œã€å¾©æ—§ç”¨ã®ä»®æƒ³ãƒã‚·ãƒ³ã‚’ä½œã‚Šã¾ã™ã€‚ãã®éš›ã€```--enable-nested``` ã‚’æŒ‡å®šã™ã‚‹ã¨ã€
å¾©æ—§ç”¨ã®ä»®æƒ³ãƒã‚·ãƒ³ã« Hyper-V ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã€ãƒ†ã‚¹ãƒˆç”¨ã®ä»®æƒ³ãƒã‚·ãƒ³ãŒãã®ä»®æƒ³ãƒã‚·ãƒ³ã® Hyper-V ä¸Šã§ç¨¼åƒã™ã‚‹ã‚ˆã†ã«ã§ãã¾ã™ã€‚

```bash
$ az vm repair create -g labnestedvm -n nestedvm --repair-username azureuser --repair-password '<yourpassword>' --enable-nested --verbose
Does repair vm requires public ip? (y/n): y
Fetching architecture type of the source VM...
Fetching compatible Windows OS images from gallery...
Fetching available VM sizes for repair VM...
VM size 'Standard_D2s_v3' is available. Using it to create repair VM.

Checking for existing resource groups with identical name within subscription...
Pre-existing repair resource group with the same name is 'False'
Creating resource group for repair VM and its resources...
Source VM uses managed disks. Creating repair VM with managed disks.

Copying OS disk of source VM...
Creating repair VM with command: az vm create -g repair-nestedvm-20240122085949 -n repair-nestedv_ --tag repair_source=labnestedvm/nestedvm --image MicrosoftWindowsServer:WindowsServer:2016-Datacenter:2016.127.20190416 --admin-username azureuser --admin-password <yourpassword> --public-ip-address repair-nestedv_PublicIP --size Standard_D2s_v3
copy_disk_id: /subscriptions/<yoursubscription>/resourceGroups/labnestedvm/providers/Microsoft.Compute/disks/nestedvm-DiskCopy-20240122085949
repair_password: <yourpassword>
repair_username: azureuser
fix_uuid: False
Validating VM template before continuing...
Creating repair VM...
Running Script win-enable-nested-hyperv.ps1 to install HyperV
Restarting Repair VM
Running win-enable-nested-hyperv.ps1 again to create nested VM

Your repair VM 'repair-nestedv_' has been created in the resource group 'repair-nestedvm-20240122085949' with disk 'nestedvm-DiskCopy-20240122085949' attached as data disk. Please use this VM to troubleshoot and repair. Once the repairs are complete use the command 'az vm repair restore -n nestedvm -g labnestedvm --verbose' to restore disk to the source VM. Note that the copied disk is created within the original resource group 'labnestedvm'.

{
  "copied_disk_name": "nestedvm-DiskCopy-20240122085949",
  "copied_disk_uri": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvm/providers/Microsoft.Compute/disks/nestedvm-DiskCopy-20240122085949",
  "created_resources": [
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Compute/virtualMachines/repair-nestedv_/extensions/MicrosoftMonitoringAgent",
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Network/networkInterfaces/repair-nestedv_VMNic",
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Compute/virtualMachines/repair-nestedv_/extensions/AzurePolicyforWindows",
    "/subscriptions/<yoursubscription>/resourceGroups/REPAIR-NESTEDVM-20240122085949/providers/Microsoft.Compute/disks/repair-nestedv__OsDisk_1_d08e2a3c2a6d4e6f887789de6e5bb989",
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Network/publicIPAddresses/repair-nestedv_PublicIP",
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Network/networkSecurityGroups/repair-nestedv_NSG",
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Network/virtualNetworks/repair-nestedv_VNET",
    "/subscriptions/<yoursubscription>/resourceGroups/repair-nestedvm-20240122085949/providers/Microsoft.Compute/virtualMachines/repair-nestedv_",
    "/subscriptions/<yoursubscription>/resourceGroups/labnestedvm/providers/Microsoft.Compute/disks/nestedvm-DiskCopy-20240122085949"
  ],
  "message": "Your repair VM 'repair-nestedv_' has been created in the resource group 'repair-nestedvm-20240122085949' with disk 'nestedvm-DiskCopy-20240122085949' attached as data disk. Please use this VM to troubleshoot and repair. Once the repairs are complete use the command 'az vm repair restore -n nestedvm -g labnestedvm --verbose' to restore disk to the source VM. Note that the copied disk is created within the original resource group 'labnestedvm'.",
  "repair_resource_group": "repair-nestedvm-20240122085949",
  "repair_vm_name": "repair-nestedv_",
  "resource_tag": "repair_source=labnestedvm/nestedvm",
  "status": "SUCCESS"
}
Command ran in 821.173 seconds (init: 0.088, invoke: 821.085)
```

![å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³](/images/7f33e05989062a/image.png)

å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å†…å®¹ã¨ã—ã¦ã¯ã€"az vm repair run" ã‚³ãƒãƒ³ãƒ‰ã‚’å†…éƒ¨ã§ï¼’å›å®Ÿè¡Œã•ã‚Œã¦ãŠã‚Šã€
é–“ã« Hyper-V ã®æœ‰åŠ¹åŒ–ã«ä¼´ã„å¾©æ—§ç”¨ã®ä»®æƒ³ãƒã‚·ãƒ³ã‚’å†èµ·å‹•ã•ã›ã¦ã„ã¾ã™ã€‚

https://github.com/Azure/azure-cli-extensions/blob/f311e026ee86c8978bab7c2caa883dad26bbb89c/src/vm-repair/azext_vm_repair/custom.py#L222-L238

"az vm repair run" ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ PowerShell ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ã“ã¡ã‚‰ã® ```win-enable-nested-hyperv.ps1``` ã§ã€ï¼‘å‘¨ç›®ã¯ä¸‹è¨˜ã«ã‚ˆã‚Š Hyper-V æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã™ã€‚

https://github.com/Azure/azure-cli-extensions/blob/f311e026ee86c8978bab7c2caa883dad26bbb89c/src/vm-repair/azext_vm_repair/scripts/win-enable-nested-hyperv.ps1#L118-L132

ï¼’å‘¨ç›®ã¯ã€ä»¥ä¸‹ã®ç‚¹ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã™ã€‚

* ä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã®ä½œæˆ
* ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®ä½œæˆ
* NAT ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä½œæˆ
* DHCP ã‚µãƒ¼ãƒ ã®æ§‹æˆ (168.63.129.16 ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«æ§‹æˆ)
* Hyper-V ä»®æƒ³ãƒã‚·ãƒ³ã®ä½œæˆ
  * 4GB ãƒ¡ãƒ¢ãƒªã®ä»®æƒ³ãƒã‚·ãƒ³ã‚’ä½œæˆ
  * ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ (å¾©æ—§å¯¾è±¡ã®ä»®æƒ³ãƒã‚·ãƒ³ã® OS ãƒ‡ã‚£ã‚¹ã‚¯) ã‚’ãƒã‚¦ãƒ³ãƒˆ
  * ãƒ–ãƒ¼ãƒˆé †åºã¨ã—ã¦ã€ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ã‚ˆã‚Šãƒ–ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«æŒ‡å®š
  * ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’æ¥ç¶š
  * ä»®æƒ³ãƒã‚·ãƒ³ã‚’èµ·å‹•
* ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å¯¾è±¡ Hyper-V ä»®æƒ³ãƒã‚·ãƒ³ãŒé–‹ãã‚ˆã†ã«ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨­å®š

https://github.com/Azure/azure-cli-extensions/blob/f311e026ee86c8978bab7c2caa883dad26bbb89c/src/vm-repair/azext_vm_repair/scripts/win-enable-nested-hyperv.ps1#L28-L116

### Azure Quickstart Templates ã‚’åˆ©ç”¨

æ¬¡ã«ç´¹ä»‹ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã¯ã€Azure Quickstart Templates ã«ã‚ã‚‹æ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã„ã¾ã™ã€‚
Azure Quickstart Templates[^5] ã«ã¯æ§˜ã€…ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«æ²¿ã£ãŸ ARM/Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã®ä½œæˆã«ã¤ã„ã¦ã¯ã€ã“ã¡ã‚‰ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚[^6]

æ—©é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™ã€‚
NIC ãŒè¤‡æ•°ä½œæˆã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ«ãƒ¼ãƒˆ (UDR) ãŒå‡ºæ¥ã‚‹ãªã©ã€å…ˆã«ç´¹ä»‹ã—ãŸæ–¹æ³•ã‚ˆã‚Šã‚‚ã†å°‘ã—è¾¼ã¿å…¥ã£ã¦ã„ã¾ã™ã€‚

```bash
yurio [ ~ ]$ az deployment group create -g labnestedvmarm -n nestedvmarm --template-uri https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/demos/nested-vms-in-virtual-network/azuredeploy.json
Please provide string value for 'HostAdminUsername' (? for help): azureuser
Please provide securestring value for 'HostAdminPassword' (? for help): 

...(çœç•¥)...

    "duration": "PT12M8.0821814S",
    "error": null,
    "mode": "Incremental",
    "onErrorDeployment": null,
    "outputResources": [
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Compute/virtualMachines/HVHOST",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Compute/virtualMachines/HVHOST/extensions/HVHOSTSetup",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Compute/virtualMachines/HVHOST/extensions/InstallWindowsFeatures",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/networkInterfaces/HVHOSTNIC1",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/networkInterfaces/HVHOSTNIC2",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/networkSecurityGroups/Azure-VMsNSG",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/networkSecurityGroups/GhostedNSG",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/networkSecurityGroups/Hyper-V-LANNSG",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/networkSecurityGroups/NATNSG",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/publicIPAddresses/HVHOSTPIP",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/routeTables/Azure-VMsUDR",
        "resourceGroup": "labnestedvmarm"
      },
      {
        "id": "/subscriptions/<yoursubscription>/resourceGroups/labnestedvmarm/providers/Microsoft.Network/virtualNetworks/VirtualNetwork",
        "resourceGroup": "labnestedvmarm"
      }
    ],
    ...(çœç•¥)...
```

å®Ÿæ–½ã—ã¦ã„ã‚‹å†…å®¹ã¨ã—ã¦ã¯ã€Desired State Configuration (DSC)[^7] æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€
ä»¥ä¸‹ã®å½¹å‰²ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã™ã€‚

DSC æ‹¡å¼µæ©Ÿèƒ½ã¯å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰æ‹¡å¼µæ©Ÿèƒ½ã‚„ã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰æ‹¡å¼µæ©Ÿèƒ½ã¨ç•°ãªã‚Šã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸­ã«å†èµ·å‹•ã‚’è¡Œã†ã“ã¨ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

* Hyper-V
* DHCP
* RemoteAccess
* Routing
* RSAT-Hyper-V-Tools
* RSAT-DHCP
* RSAT-RemoteAccess[^8]

æ¬¡ã«ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ‹¡å¼µæ©Ÿèƒ½ã«ã¦ã€hvhostsetup.ps1 ã‚’å®Ÿè¡Œã—ã€Final configuration ã«è¨˜è¼‰ã®ã‚ã‚‹è¨­å®šã‚’è¡Œã£ã¦ã„ã‚‹æ¨¡æ§˜ã€‚[^9]
Hyper-V ãƒ›ã‚¹ãƒˆã¯ï¼’ã¤ã® NIC ã‚’æŒã¡ã€ç‰‡æ–¹ã¯ NAT ç”¨ã€ã‚‚ã†ç‰‡æ–¹ã¯ Hyper-V ä»®æƒ³ãƒã‚·ãƒ³å´ã®ã‚µãƒ–ãƒãƒƒãƒˆã«è¶³ã‚’å‡ºã—ã¦ã„ã¾ã™ã€‚[^10]

### ã¾ã¨ã‚

ä»¥ä¸Š2ã¤å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³ãƒã‚·ãƒ³ (æ­£ç¢ºã«ã¯ Hyper-V ãŒæœ‰åŠ¹ãªä»®æƒ³ãƒã‚·ãƒ³) ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚
ï¼‘ã¤ç›®ã®æ–¹æ³•ã¯é£½ãã¾ã§ã‚‚å¾©æ—§æ‰‹æ®µã«ç”¨ã„ã‚‹æ–¹æ³•ã§ ```az vm repair restore``` ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šå¾©æ—§ç”¨ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã€å¾©æ—§å¯¾è±¡ã®ä»®æƒ³ãƒã‚·ãƒ³ã® OS ãƒ‡ã‚£ã‚¹ã‚¯ã‚’å…¥ã‚Œæ›¿ãˆã‚‹å‹•ä½œã‚’è¡Œã†ãŸã‚ã€ãã®ç‚¹ç•™æ„ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

[^1]: [å…¥ã‚Œå­ã«ãªã£ãŸä»®æƒ³åŒ–ã®æ¦‚è¦](https://learn.microsoft.com/ja-jp/virtualization/hyper-v-on-windows/user-guide/nested-virtualization)
[^2]: [Hyper-V VM ä¸Šã® Hyper-V VM](https://learn.microsoft.com/ja-jp/virtualization/hyper-v-on-windows/user-guide/nested-virtualization#hyper-v-vms-on-hyper-v-vms)
[^3]: [az vm repair ã‚³ãƒãƒ³ãƒ‰](https://learn.microsoft.com/ja-jp/cli/azure/vm/repair?view=azure-cli-latest)
[^4]: [Hyper-V is not installed in reapirVM #7177](https://github.com/Azure/azure-cli-extensions/issues/7177)
[^5]: [Azure Quickstart Templates](https://github.com/Azure/azure-quickstart-templates/tree/master)
[^6]: [nested-vms-in-virtual-network ã‚µãƒ³ãƒ—ãƒ«](https://learn.microsoft.com/en-us/samples/azure/azure-quickstart-templates/nested-vms-in-virtual-network/)
[^7]: [Desired State Configuration (DSC) æ‹¡å¼µæ©Ÿèƒ½](https://learn.microsoft.com/ja-jp/azure/virtual-machines/extensions/dsc-template)
[^8]: [azuredeploy.json#L356-L378](https://github.com/Azure/azure-quickstart-templates/blob/16698a1be9c801e7555baa855c53757e860574d1/demos/nested-vms-in-virtual-network/azuredeploy.json#L356-L378)
[^9]: [hvhostsetup.ps1](https://github.com/Azure/azure-quickstart-templates/blob/master/demos/nested-vms-in-virtual-network/hvhostsetup.ps1) ã¨ [Final configuration](https://github.com/Azure/azure-quickstart-templates/tree/master/demos/nested-vms-in-virtual-network#final-configuration)
[^10]: [azuredeploy.json#L379-L402](https://github.com/Azure/azure-quickstart-templates/blob/16698a1be9c801e7555baa855c53757e860574d1/demos/nested-vms-in-virtual-network/azuredeploy.json#L379-L402)