---
title: "入れ子になった仮想マシンの構築"
emoji: "📦"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

入れ子になった仮想マシンを手早く用意したい場面があったので、まとめておきます。

### 入れ子になった仮想マシンとは

入れ子になった仮想マシンとは、仮想マシンの中で仮想マシンを動作させるため、
ハイパーバイザがインストールされた仮想マシンを指します。

参考; [入れ子になった仮想化の概要](https://learn.microsoft.com/ja-jp/virtualization/hyper-v-on-windows/user-guide/nested-virtualization)


### 

### az vm repair create コマンドによる

```bash
$ az group create -n labnestedvm -l japaneast
$ az vm create -g labnestedvm --name nestedvm --image Win2022AzureEditionCore --admin-username azureuser --public-ip-address ""
```

```bash
$ az extension add -n vm-repair
$ az vm repair create -g labnestedvm -n nestedvm --repair-username azureuser --repair-password 'password!234' --enable-nested --verbose
```



https://github.com/Azure/azure-cli-extensions/blob/main/src/vm-repair/azext_vm_repair/scripts/win-enable-nested-hyperv.ps1